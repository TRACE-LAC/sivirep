---
author: "TRACE-LAC"
date: "`r Sys.Date()`"
output:
  pdf_document: 
    number_sections: true
  html_document:
    number_sections: true
  word_document: 
    number_sections: true
header-includes:
- \usepackage{fancyhdr}
subtitle: (fuente SIVIGILA, Datos libres)
params:
  year:
    value: 2020
    label: Año
  disease_name:
    value: "Dengue" 
    label: Enfermedad
  department:
    value: "Antioquia" 
    label: Departamento
    input: select
    choices: !r get_departments()
  municipalitie:
    value: ""
    label: Municipio
---

```{r setup, echo = FALSE, error = FALSE, warning = FALSE, include = FALSE, message = FALSE}
knitr::opts_chunk$set(include = TRUE,
                      echo = FALSE,
                      error = FALSE,
                      warning = FALSE,
                      message = FALSE)
library(sivirep)
```

---
title: "Reporte Automatizado para `r params$disease_name`, `r params$department` - Colombia `r params$year`"
---

```{r import_data, include = FALSE}
disease_data <-  import_linelist_disease_year(params$year, params$disease_name)
```

```{r clean_data, include = FALSE}
clean_disease_data <-  cleansing_sivigila_data(disease_data, params$year)
```

```{r filter_data, include = FALSE}
filter_disease_data <-  geo_filter(clean_disease_data, params$department)
```

```{=tex}
\pagenumbering{gobble}
\pagenumbering{arabic}
```

En este reporte se presenta el comportamiento del `r params$disease_name` durante el año `r params$year` para Colombia con base en la fuente de datos SIVIGILA de acceso libre. En total en Colombia durante `r params$year` se reportaron `r nrow(disease_data)` casos en todo el territorio nacional.

# Distribución temporal de los casos

```{r cases_by_onset_symptom_date, include = FALSE}
cases_onset_symptoms_by_day <- group_onset_symptoms(filter_disease_data,
                                                    type = "day")
months_most_cases <- get_months_most_cases(cases_onset_symptoms_by_day,
                                           col_dates = "ini_sin")
```

Los casos se distribuyen a lo largo de los meses de enero a diciembre de `r params$year`, teniendo un mayor reporte en los meses `r months_most_cases` tanto por fecha de inicio de síntomas (Ver Figura 1) como por fecha de notificación (Ver Figura 2). Este comportamiento pudo haber sido distinto a años previos debido al inicio de estrategias de control de COVID-19 a comienzos de marzo de `r params$year`.

```{r plot_cases_by_onset_symptom_date, fig.height = 5, fig.width = 10, fig.cap = "Distribucion de casos por dia de inicio de sintomas"}
plot_onset_symptoms(data_grouped = cases_onset_symptoms_by_day,
                    break_tick_date = "months")
```

```{r cases_by_onset_notification_date, include = FALSE}
cases_notification_date_by_day <- group_notification_date(filter_disease_data,
                                                          type = "day")
```

\newpage 

```{r plot_cases_by_onset_notification_date, fig.height = 5, fig.width = 10, fig.cap = "Distribucion de casos por fecha de notificacion"}
plot_notification_date(data_grouped = cases_notification_date_by_day,
                       break_tick_date = "months")
```

# Distribución de casos por sexo y semana epidemiológica

```{r distribution_cg, include = FALSE}
cases_sex <- group_sex(filter_disease_data)
male_percentage <- cases_sex$porcentaje[2]
female_percentage <- cases_sex$porcentaje[1]
sex_most_cases <- get_most_cases(cases_sex)
```

En el total de casos para `r params$year` se observa una predominancia del sexo masculino (`r male_percentage`%) con respecto al sexo femenino (`r female_percentage`%) (Ver Figura 3).

```{r distribution_cg_plot, fig.height = 4, fig.width = 9, fig.cap =  "Distribucion de casos por genero"}
plot_sex(cases_sex)
```
\newpage

```{r distribution_cg_epiweek, include = FALSE}
cases_sex_epiweek <- group_sex_epiweek(disease_data = filter_disease_data)
```

Esta predominancia del reporte de casos en sexo masculino se mantuvo a lo largo de todas las semanas epidemiológicas (Ver figura 4).

```{r plot_cg_epiweek, fig.height = 5, fig.width = 11, fig.cap =  "Distribucion de casos por genero y semana epidemiologica"}
plot_sex_epiweek(data_grouped = cases_sex_epiweek)
```

# Distribución de casos por edad

```{r distribution_age_d, include = FALSE}
cases_age <- group_age(disease_data = filter_disease_data, age_interval = 10)
age_most_cases <- get_most_cases(cases_age)
```

La distribución de los casos por grupos etarios muestra una tendencia decreciente a medida que se avanza en la edad. La población de `r age_most_cases$edad` años representó el `r  age_most_cases$porcentaje` % de todos los casos de `r params$disease_name` en el país (Ver figura 5). De forma interesante, aunque el sexo masculino predominó en casi todos los grupos etários, para el grupo de 0-10 años esta predominancia fue mucho menos marcada (Ver Figura 6).

```{r distribution_age, fig.height = 3, fig.width = 8, fig.cap =  "Distribucion de casos por edad"}
plot_age(data_grouped = cases_age)
```

\newpage

# Distribución de casos por edad y sexo

```{r distribution_age_anger, fig.height = 3, fig.width = 9, fig.cap =  "Distribucion de casos por edad y genero"}
cases_age_sex <- group_age_sex(disease_data = filter_disease_data,
                               age_interval = 10)
plot_age_sex(data_grouped = cases_age_sex)
```

# Distribución de casos por población especial

```{r distribution_sp, fig.height = 6, fig.width = 11, fig.cap =  "Distribucion de casos por poblacion especial"}
cases_special_population <- group_special_population(filter_disease_data)
plot_special_population(cases_special_population)
```

\newpage

# Distribución espacial de casos

```{r group_distribution_spatial,  results='hide', echo = FALSE, error = FALSE, warning = FALSE, include = FALSE, message = FALSE}
#spatial_dept_dist <- group_dept(disease_data = filter_disease_data)
#map <- plot_dept_map(data_grouped = spatial_dept_dist)
spatial_muns_dist <- group_mun(disease_data = filter_disease_data,
                               dept_name = params$department)
spatial_most_cases <- get_most_cases(spatial_muns_dist)
map <- plot_map(data_grouped = spatial_muns_dist,
                department = params$department)
```

Los casos se distribuyen a lo largo de `r nrow(spatial_muns_dist)` municipios del departamento de `r param$department`, teniendo un mayor reporte el municipio de `r stringr::str_to_title(spatial_most_cases$nombre)` con `r spatial_most_cases$casos` casos (Ver Figura 7).

```{r plot_distribution_municipalities, fig.height = 10, fig.width = 10, fig.cap = "Distribucion de casos por municipio"}
plot_spatial <- plot_muns(spatial_muns_dist)
plot_spatial
```

```{r map_distribution_spatial, echo = FALSE, error = FALSE, warning = FALSE, include = TRUE, message = FALSE, cache = FALSE, results = FALSE, comment = FALSE, fig.height = 10, fig.width = 10, fig.cap =  "Distribucion espacial de casos"}
map
```

\newpage

# Conclusiones

a.  Los casos totales reportados de `r params$disease_name` en Colombia en el año `r params$year` fueron `r nrow(disease_data)`.
b.  Los meses de `r months_most_cases` tuvieron el mayor reporte. Es posible que haya un impacto en el menor reporte y/o menor transmisión de `r params$disease_name` como producto de la pandemia COVID-19 y medidas de control que iniciaron en marzo de `r params$year`.
c.  El reporte de casos de `r params$disease_name` a lo largo de `r params$year` predominó en la población de `r age_most_cases$edad` años.
d.  El reporte de casos de `r params$disease_name` predominó a lo largo del año en el sexo masculino.
