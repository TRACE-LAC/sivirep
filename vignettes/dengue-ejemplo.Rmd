---
title: "Reporte de Dengue, Colombia 2020"
author: "TRACE-LAC"
date: '2023-02-01'
output:
  pdf_document: default
  word_document: default
  html_document: default
subtitle: (fuente SIVIGILA, Datos libres)
---

```{r setup, echo=FALSE, error=FALSE, fig.height=5, fig.width=5, warning=FALSE, include = FALSE, message= FALSE}
knitr::opts_chunk$set(echo = TRUE)
remotes::install_github("epiverse-trace/sivirep", ref = "dev")

rm(list = ls())

library(sivirep)
library(dplyr) 
library(ggplot2) 
```


## Reporte de dengue en Colombia 2020

<!-- ```{r read, echo=FALSE, error=FALSE, fig.height=5, fig.width=5, warning=FALSE, include = FALSE, message= FALSE} -->
<!-- sivigila_data <- import_sivigila_summary_data() -->
<!-- filtered_data <- filter_disease("DENGUE", sivigila_data) -->

<!-- # Esto hay que sacarlo, a menos que sea para mostrar las enfermedades con las que se pueda trabajar. Pero para un reporte de enfermedad NOOOOO sirve -->

<!-- ``` -->
<!-- A continuación se presentan 8 figuras que muestran la distribución de casos por semana epidemiológica, la distribución de casos por fecha de inicio de síntomas, casos por fecha de notificación, la distribución de casos por poblaciones especiales, casos por sexo, casos por sexo y semana epidemiológica, casos por edad y distribución de casos por edad y sexo. -->

<!-- ## Distribución de casos por semana epidemiológica -->


<!-- ```{r epiweek, echo=FALSE, error=FALSE, fig.height=5, fig.width=10, warning=FALSE, include = TRUE, message= FALSE} -->

<!-- plot_epiweek(filtered_data, col_week = "SEMANA", col_cases = "Casos", year = 2019, type = "date", xlabel = "Fecha de semana epidemiologica") -->

<!-- ``` -->
<!-- **Figura 1.** Distribución de casos de dengue por semana  epidemiológica entre enero de 2019 y enero de 2020. -->



```{r import_data, echo=FALSE, error=FALSE, fig.height=8, fig.width=8, warning=FALSE, include = FALSE, message= FALSE}
disease_data       <-  import_data_disease_by_year(2020, "DENGUE")

```

## Distribución de casos por fecha de inicio de síntomas
```{r disease_data, echo=FALSE, error=FALSE, fig.height=5, fig.width=8, warning=FALSE, include=TRUE, message=FALSE}

# Todo esto hay que ponerlo en una serie de dunciones sin hacer uso de base R
disease_dt_by_onset_sym <- disease_data
disease_dt_by_onset_sym$INI_SIN <- as.Date(disease_data$FEC_HOS, format = "%AAAA-%MM-%DD")
disease_dt_by_onset_sym$INI_SIN <- as.Date(disease_data$INI_SIN, format = "%AAAA-%MM-%DD")
disease_dt_by_onset_sym <- remove_nin_values(disease_data, "INI_SIN")
disease_dt_by_onset_sym <- remove_error_dates(disease_dt_by_onset_sym)
disease_dt_by_onset_sym <- group_by_columns_and_cases(disease_dt_by_onset_sym, "INI_SIN")
disease_dt_by_onset_sym <- disease_dt_by_onset_sym %>% filter(!row_number() %in% c(1, 2, 3, 4, 5, 6))
#disease_dt_by_onset_sym[order(disease_dt_by_onset_sym$INI_SIN, decreasing = TRUE), ] # Esta línea sólo cumple el propósito de imprimir, pero no cambia nada de los datos. COmo está no tiene ninguna utilidad

ggplot(disease_dt_by_onset_sym, aes(x = INI_SIN, y = Casos)) + 
  geom_bar(stat="identity", fill="royalblue4") + 
  labs(x = "Fecha de inicio de síntomas", y = "Número de casos") + 
  theme_classic(20) + 
  scale_x_date(date_breaks = "1 month", date_labels = "%b %d")

```
**Figura 1.** Distribución de casos por fecha de inicio de síntomas.

```{r distribution_not, echo=FALSE, error=FALSE, fig.height=5, fig.width=10, warning=FALSE, include=TRUE, message=FALSE}
disease_data_not <- disease_data
disease_data_not$FEC_NOT <- as.Date(disease_data$FEC_NOT, format = "%AAAA-%MM-%DD")
disease_data_not <- group_by_columns_and_cases(disease_data, "FEC_NOT")
#disease_data_not[order(disease_data_not$FEC_NOT, decreasing = TRUE), ]  # Esta línea sólo cumple el propósito de imprimir, pero no cambia nada de los datos. COmo está no tiene ninguna utilidad

plot_by_variable(disease_data_not, var_x = "FEC_NOT", 
                 var_y = "Casos",
                 label_x = "Fecha de notificacion", 
                 label_y = "Casos", 
                 diagram_title = "", # Por favor remover
                 legend_pos = "right", 
                 show_val = FALSE) 

#+
  # scale_x_date(date_breaks = "1 month", date_labels = "%b %d")  # Esta debería poderse agregar

# error: Error: Must request at least one colour from a hue palette.


```
**Figura 4.** Fecha de notificación de los casos de dengue.


## Distribución de casos por poblaciones especiales
```{r distribution_sp, echo=FALSE, error=FALSE, fig.height=7, fig.width=15, warning=FALSE, include=TRUE, message=FALSE}
disease_dt_special <- get_special_population_and_cases(disease_data)
disease_dt_special[disease_dt_special == "GP_DISCAPA"] <- "Discapacitados"
disease_dt_special[disease_dt_special == "GP_DESPLAZ"] <- "Desplazados"
disease_dt_special[disease_dt_special == "GP_MIGRANT"] <- "Migrantes"
disease_dt_special[disease_dt_special == "GP_CARCELA"] <- "Carcelaria"
disease_dt_special[disease_dt_special == "GP_GESTAN"] <- "Gestante"
disease_dt_special[disease_dt_special == "GP_INDIGEN"] <- "Indigente"
disease_dt_special[disease_dt_special == "GP_POBICFB"] <- "Pob. infantil del ICBF"
disease_dt_special[disease_dt_special == "GP_MAD_COM"] <- "Madres comunitarias"
disease_dt_special[disease_dt_special == "GP_DESMOVI"] <- "Desmovilizados"
disease_dt_special[disease_dt_special == "GP_PSIQUIA"] <- "Psiquiatrica"
disease_dt_special[disease_dt_special == "GP_VIC_VIO"] <- "Victimas de violencia"
disease_dt_special[disease_dt_special == "GP_OTROS"] <- "Otros"

plot_by_variable(disease_dt_special, 
                 var_x = "Poblacion", 
                 var_y = "Casos", 
                 var_fill = "Poblacion", 
                 label_x = "Poblacion", 
                 label_y = "Casos", 
                 scale_name = "Poblacion", 
                 # diagram_title = "", 
                 legend_pos = "right", 
                 bar_wd = 1, 
                 text_sz = 10, 
                 show_val = TRUE) + 
  coord_flip()
  

```
**Figura 5.** Distribución de casos por poblaciones especiales para 12 grupos poblacionales.


## Distribución de casos por sexo
```{r distribution_cg, echo=FALSE, error=FALSE, fig.height=5, fig.width=10, warning=FALSE, include=TRUE, message=FALSE}
disease_dt_by_gender <- group_by_columns_and_cases(disease_data, "SEXO", wt_percentage = TRUE)

plot_by_variable(disease_dt_by_gender, 
                 var_x = "SEXO", 
                 var_y = "Casos", 
                 var_fill = "SEXO", 
                 var_per = "Porcentaje", 
                 label_x = "Sexo", 
                 label_y = "Número de casos", 
                 scale_name = "Sexo", 
                 scale_labels = c("Femenino", "Masculino"), 
                 diagram_title ="", 
                 legend_pos = "right", 
                 bar_wd = 0.6, 
                 text_sz = 10, 
                 show_val = TRUE) +
  scale_fill_manual(values=c("#56B4E9", "#E69F00"))
  

# Verificar que el tamaño aumente en todo el texto de la gráfica
```
**Figura 6.** Distribución de casos por la variable sexo.


## Distribución de casos por género y semana epidemiológica
```{r distribution_epiweek, echo=FALSE, error=FALSE, fig.height=5, fig.width=10, warning=FALSE, include=TRUE, message=FALSE}
disease_dt_by_gender_wk <- group_by_columns_and_cases(disease_data, c("SEMANA","SEXO"), TRUE)

plot_by_variable(disease_dt_by_gender_wk, 
                 var_x = "SEMANA", 
                 var_y = "Casos", var_fill = "SEXO", var_per = "Porcentaje", label_x = "Semana epidemiológica", label_y = "Casos", scale_name = "Sexo", scale_labels = c("Femenino", "Masculino"), diagram_title = "", legend_pos = "right", bar_wd = 1, text_sz = 0.5, show_val = FALSE) +
    scale_fill_manual(values=c("#56B4E9", "#E69F00"))
```
**Figura 7.** Distribución de casos por sexo y semana epidemiológica.


## Distribución de casos por edad
```{r distribution_age, echo=FALSE, error=FALSE, fig.height=5, fig.width=10, warning=FALSE, include=TRUE, message=FALSE}
disease_dt_by_age <- parse_age_to_years(disease_data)
disease_dt_by_age <- remove_nin_values(disease_dt_by_age, "EDAD")
disease_dt_by_age <- group_by_columns_and_cases(disease_dt_by_age, c("EDAD", "SEMANA"), wt_percentage = TRUE)
disease_dt_by_age_range <- group_by_age_range_and_cases(disease_dt_by_age, "EDAD", min_val = 0, max_val = max(disease_dt_by_age$EDAD), step = 10)

#plot_by_variable(disease_dt_by_age_range, var_x = "EDAD", var_y = "Casos", var_fill = "EDAD",label_x = "Edad", label_y = "Casos", scale_name = "Edad", diagram_title = "", legend_pos = "right", bar_wd = 0.7, text_sz = 3)
ggplot(disease_dt_by_age_range, aes(x = EDAD, y = Casos)) + geom_bar(stat="identity", fill="royalblue4") + ggplot2::labs(x = "Edad", y = "Casos") + theme_classic() + ggplot2::geom_text( ggplot2::aes(label = Casos ), vjust = 1.3, color = "white", hjust = 0.5, position = ggplot2::position_dodge(0.9), angle = 0, size = 3)
```
**Figura 8.** Distribución de casos por edad.


## Distribución de casos por edad y sexo
```{r distribution_age_anger, echo=FALSE, error=FALSE, fig.height=5, fig.width=10, warning=FALSE, include=TRUE, message=FALSE}
disease_dt_by_age_gen <- parse_age_to_years(disease_data)
disease_dt_by_age_gen <- remove_nin_values(disease_dt_by_age_gen, "EDAD")
disease_dt_by_age_gen <- group_by_columns_and_cases(disease_dt_by_age_gen, c("EDAD", "SEXO"), wt_percentage = TRUE)
disease_dt_by_age_gen_range <- group_by_age_range_and_cases(disease_dt_by_age_gen, "EDAD", "SEXO", min_val = 0, max_val = max(disease_dt_by_age_gen$EDAD), 10)

plot_by_variable(disease_dt_by_age_gen_range, var_x = "EDAD", var_y = "Casos", var_fill = "SEXO",label_x = "Edad", label_y = "Casos", scale_name = "Edad", diagram_title = "", legend_pos = "right", bar_wd = 0.7, text_sz = 3, show_val = FALSE)
```
**Figura 9** Distribucipon de casos por edad y sexo.