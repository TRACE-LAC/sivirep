---
title: "Reporte de Dengue, Colombia 2020"
author: "TRACE-LAC"
date: '2023-02-01'
output:
  pdf_document: default
  word_document: default
  html_document: default
subtitle: (fuente SIVIGILA, Datos libres)
---

```{r setup, echo=FALSE, error=FALSE, fig.height=5, fig.width=5, warning=FALSE, include = FALSE, message= FALSE}
knitr::opts_chunk$set(echo = TRUE)
remotes::install_github("epiverse-trace/sivirep", ref = "dev")

rm(list = ls())

library(sivirep)
library(dplyr) 
library(ggplot2) 
```


## Reporte de dengue en Colombia 2020


```{r import_data, echo=FALSE, error=FALSE, fig.height=8, fig.width=8, warning=FALSE, include = FALSE, message= FALSE}
disease_data       <-  import_data_disease_by_year(2020, "DENGUE")

```

## Distribución de casos por fecha de inicio de síntomas
```{r disease_data, echo=FALSE, error=FALSE, fig.height=5, fig.width=8, warning=FALSE, include=TRUE, message=FALSE}
# Todo esto hay que ponerlo en una serie de funciones sin hacer uso de base R
disease_dt_by_onset_sym <- disease_data
disease_dt_by_onset_sym$INI_SIN <- as.Date(disease_data$FEC_HOS, format = "%AAAA-%MM-%DD")
disease_dt_by_onset_sym$INI_SIN <- as.Date(disease_data$INI_SIN, format = "%AAAA-%MM-%DD")
disease_dt_by_onset_sym <- remove_nin_values(disease_data, "INI_SIN")
disease_dt_by_onset_sym <- remove_error_dates(disease_dt_by_onset_sym)
disease_dt_by_onset_sym <- group_by_columns_and_cases(disease_dt_by_onset_sym, "INI_SIN")
disease_dt_by_onset_sym <- disease_dt_by_onset_sym %>% filter(!row_number() %in% c(1, 2, 3, 4, 5, 6))
#disease_dt_by_onset_sym[order(disease_dt_by_onset_sym$INI_SIN, decreasing = TRUE), ] # Esta línea sólo cumple el propósito de imprimir, pero no cambia nada de los datos. COmo está no tiene ninguna utilidad
plot_by_variable(disease_dt_by_onset_sym, 
                 var_x = "INI_SIN", 
                 var_y = "Casos", 
                 label_x = "Fecha de inicio de sIntomas", 
                 label_y = "Número de casos", 
                 legend_pos = "right", 
                 text_sz = 4, 
                 show_val = FALSE) + scale_x_date(date_breaks = "1 month", 
                 date_labels = "%b %d")
```
**Figura 1.** Distribución de casos por fecha de inicio de síntomas.

```{r distribution_not, echo=FALSE, error=FALSE, fig.height=5, fig.width=10, warning=FALSE, include=TRUE, message=FALSE}
disease_data_not <- disease_data
disease_data_not$FEC_NOT <- as.Date(disease_data$FEC_NOT, format = "%AAAA-%MM-%DD")
disease_data_not <- group_by_columns_and_cases(disease_data, "FEC_NOT")

plot_by_variable(disease_data_not, var_x = "FEC_NOT", 
                 var_y = "Casos", 
                 label_x = "Fecha de notificacion", 
                 label_y = "Número de casos",
                 legend_pos = "right", 
                 show_val = FALSE) + 
                 scale_x_date(date_breaks = "1 month", 
                 date_labels = "%b %d")

```
**Figura 2.** Fecha de notificación de los casos de dengue.


## Distribución de casos por sexo
```{r distribution_cg, echo=FALSE, error=FALSE, fig.height=5, fig.width=10, warning=FALSE, include=TRUE, message=FALSE}
disease_dt_by_gender <- group_by_columns_and_cases(disease_data, "SEXO", wt_percentage = TRUE)

plot_by_variable(disease_dt_by_gender, 
                 var_x = "SEXO", 
                 var_y = "Casos", 
                 var_fill = "SEXO", 
                 var_per = "Porcentaje", 
                 label_x = "Sexo", 
                 label_y = "Número de casos", 
                 scale_name = "Sexo", 
                 scale_labels = c("Femenino", "Masculino"), 
                 diagram_title  = "", 
                 legend_pos = "right", 
                 bar_wd = 0.6, 
                 text_sz = 8, 
                 show_val = TRUE) +
  scale_fill_manual(values = c("#56B4E9", "#E69F00"))
  

# Verificar que el tamaño aumente en todo el texto de la gráfica
```
**Figura 3.** Distribución de casos por la variable sexo.


## Distribución de casos por género y semana epidemiológica
```{r distribution_epiweek, echo=FALSE, error=FALSE, fig.height=5, fig.width=10, warning=FALSE, include=TRUE, message=FALSE}
disease_dt_by_gender_wk <- group_by_columns_and_cases(disease_data, c("SEMANA","SEXO"), TRUE)

plot_by_variable(disease_dt_by_gender_wk, 
                 var_x = "SEMANA", 
                 var_y = "Casos", 
                 var_fill = "SEXO", 
                 var_per = "Porcentaje", 
                 label_x = "Semana epidemiológica", 
                 label_y = "Número de casos", 
                 scale_name = "Sexo",
                 scale_labels = c("Femenino", "Masculino"), 
                 diagram_title = "", legend_pos = "right", 
                 bar_wd = 0.7, 
                 text_sz = 0.5, 
                 show_val = FALSE) +
    scale_fill_manual(values=c("#56B4E9", "#E69F00"))
```
**Figura 4.** Distribución de casos por sexo y semana epidemiológica.


## Distribución de casos por edad
```{r distribution_age, echo=FALSE, error=FALSE, fig.height=5, fig.width=10, warning=FALSE, include=TRUE, message=FALSE}
disease_dt_by_age <- parse_age_to_years(disease_data)
disease_dt_by_age <- remove_nin_values(disease_dt_by_age, "EDAD")
disease_dt_by_age <- group_by_columns_and_cases(disease_dt_by_age, c("EDAD", "SEMANA"), wt_percentage = TRUE)
disease_dt_by_age_range <- group_by_age_range_and_cases(disease_dt_by_age, "EDAD", min_val = 0, max_val = max(disease_dt_by_age$EDAD), step = 10)

plot_by_variable(disease_dt_by_age_range,
                 var_x = "EDAD", 
                 var_y = "Casos", 
                 var_fill = "EDAD",
                 label_x = "Edad", 
                 label_y = "Número de casos", 
                 scale_name = "Edad", 
                 legend_pos = "right", 
                 bar_wd = 0.7, 
                 text_sz = 3)
```
**Figura 5.** Distribución de casos por edad.


## Distribución de casos por edad y sexo
```{r distribution_age_anger, echo=FALSE, error=FALSE, fig.height=5, fig.width=10, warning=FALSE, include=TRUE, message=FALSE}
disease_dt_by_age_gen <- parse_age_to_years(disease_data)
disease_dt_by_age_gen <- remove_nin_values(disease_dt_by_age_gen, "EDAD")
disease_dt_by_age_gen <- group_by_columns_and_cases(disease_dt_by_age_gen, c("EDAD", "SEXO"), wt_percentage = TRUE)
disease_dt_by_age_gen_range <- group_by_age_range_and_cases(disease_dt_by_age_gen, "EDAD", "SEXO", min_val = 0, max_val = max(disease_dt_by_age_gen$EDAD), 10)

plot_by_variable(disease_dt_by_age_gen_range, 
                 var_x = "EDAD", 
                 var_y = "Casos", 
                 var_fill = "SEXO",
                 label_x = "Edad", 
                 label_y = "Numero de casos", 
                 scale_name = "Edad", 
                 legend_pos = "right", 
                 bar_wd = 0.7, 
                 text_sz = 3, 
                 show_val = FALSE) +
  scale_fill_manual(values=c("#CC6666", "#9999CC"))
```
**Figura 6** Distribucipon de casos por edad y sexo.