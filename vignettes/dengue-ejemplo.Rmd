---
author: "TRACE-LAC"
date: "`r Sys.Date()`"
output:
  pdf_document: 
    number_sections: true
  html_document:
    number_sections: true
  word_document: 
    number_sections: true
header-includes:
- \usepackage{fancyhdr}
subtitle: (fuente SIVIGILA, Datos libres)
---

```{r setup, echo=FALSE, error=FALSE, warning=FALSE, include = FALSE, message= FALSE}
knitr::opts_chunk$set(echo = TRUE)
#remotes::install_github("epiverse-trace/sivirep", ref = "dev-feature-sections-bsreport")

#rm(list = ls())

library(sivirep)

year <- 2020
disease_name <-  "Dengue"
```

---
title: "Reporte Automatizado para `r disease_name`, Colombia `r year`"
---

```{r import_data, echo=FALSE, error=FALSE, warning=FALSE, include = FALSE, message = FALSE}
disease_data <-  import_data_disease_by_year(year, toupper(disease_name))
```

```{r clean_data, echo=FALSE, error=FALSE, warning=FALSE, include = FALSE, message= FALSE}
clean_disease_data <-  clean_sivigila_data(disease_data, year)
```

```{=tex}
\pagenumbering{gobble}
\pagenumbering{arabic}
```

En este reporte se presenta el comportamiento del `r disease_name` durante el año `r year` para Colombia con base en la fuente de datos SIVIGILA de acceso libre. En total en Colombia durante `r year` se reportaron `r nrow(disease_data)` casos en todo el territorio nacional.

# Distribución temporal de los casos

```{r cases_by_onset_symptom_date, echo=FALSE, error=FALSE, warning=FALSE, include=TRUE, message=FALSE}
onset_symptoms_data <- group_by_onset_symptoms(clean_disease_data, type = "month") 
months_major_cases <- get_months_major_cases(onset_symptoms_data, col_dates = "ini_sin")
```

Los casos se distribuyen a lo largo de los meses de enero a diciembre de `r year`, teniendo un mayor reporte en los meses `r months_major_cases` tanto por fecha de inicio de síntomas (Ver Figura 1) como por fecha de notificación (Ver Figura 2). Este comportamiento pudo haber sido distinto a años previos debido al inicio de estrategias de control de COVID-19 a comienzos de marzo de `r year`.

```{r plot_cases_by_onset_symptom_date, echo = FALSE, error = FALSE,  warning = FALSE, include = TRUE, message = FALSE, fig.height = 5, fig.width = 10, fig.cap = "Distribucion de casos por fecha de inicio de sintomas"}
plot_onset_symptoms(onset_symptoms_data, type = "month")
```

```{r cases_by_onset_notification_date, echo = FALSE, error = FALSE, warning = FALSE, include = FALSE, message = FALSE}
notification_date_data <- group_by_notification_date(clean_disease_data, type = "month")
```

\newpage 

```{r plot_cases_by_onset_notification_date, echo = FALSE, error = FALSE, warning = FALSE, include = TRUE, message = FALSE, fig.height = 5, fig.width = 10, fig.cap = "Distribucion de casos por fecha de notificacion"}
plot_notification_date(notification_date_data, type = "month")
```

# Distribución de casos por sexo y semana epidemiológica

```{r distribution_cg, echo = FALSE, error = FALSE, warning = FALSE, include = FALSE, message = FALSE}
gender_data <- group_by_gender(clean_disease_data)
male_percentage <- gender_data$porcentaje[2]
female_percentage <- gender_data$porcentaje[1]
gender_major_cases <- get_major_cases(gender_data)
```

En el total de casos para `r year` se observa una predominancia del sexo masculino (`r male_percentage`%) con respecto al sexo femenino (`r female_percentage`%) (Ver Figura 3).

```{r distribution_cg_plot, echo = FALSE, error = FALSE,  warning = FALSE, include = TRUE, message = FALSE, fig.height = 3, fig.width = 7, fig.cap =  "Distribucion de casos por genero"}
plot_gender(gender_data)
```

\newpage

```{r distribution_cg_epiweek, echo = FALSE, error = FALSE, warning = FALSE, include = FALSE, message=FALSE}
gender_and_week_data <- group_by_gender_and_week(clean_disease_data)
```

Esta predominancia del reporte de casos en sexo masculino se mantuvo a lo largo de todas las semanas epidemiológicas (Ver figura 4).

```{r plot_cg_epiweek, echo = FALSE, error = FALSE,  warning = FALSE, include = TRUE, message = FALSE, fig.height = 5, fig.width = 11, fig.cap =  "Distribucion de casos por genero y semana epidemiologica"}
plot_gender_and_week(gender_and_week_data)
```

# Distribución de casos por edad

```{r distribution_age_d, echo = FALSE, error = FALSE, warning = FALSE, include = FALSE, message=FALSE}
age_and_week_data <- group_by_age_and_week(clean_disease_data)
age_range_major_cases <- get_major_cases(age_and_week_data)
```

La distribución de los casos por grupos etarios muestra una tendencia decreciente a medida que se avanza en la edad. La población de `r age_range_major_cases$edad` años representó el `r  age_range_major_cases$porcentaje` % de todos los casos de `r disease_name` en el país (Ver figura 5). De forma interesante, aunque el sexo masculino predominó en casi todos los grupos etários, para el grupo de 0-10 años esta predominancia fue mucho menos marcada (Ver Figura 6).

```{r distribution_age, echo = FALSE, error = FALSE,  warning = FALSE, include = TRUE, message = FALSE, fig.height = 3, fig.width = 8, fig.cap =  "Distribucion de casos por edad y semana epidemiologica"}
plot_age_and_week(age_and_week_data)
```

\newpage

# Distribución de casos por edad y sexo

```{r distribution_age_anger, echo = FALSE, error = FALSE,  warning = FALSE, include = TRUE, message = FALSE, fig.height = 3, fig.width = 9, fig.cap =  "Distribucion de casos por edad y genero"}
age_and_gender_data <- group_by_age_and_gender(clean_disease_data)
plot_age_and_gender(age_and_gender_data)
```

# Distribución de casos por población especial

```{r distribution_sp, echo = FALSE, error = FALSE,  warning = FALSE, include = TRUE, message = FALSE, fig.height = 6, fig.width = 11, fig.cap =  "Distribucion de casos por poblacion especial"}
special_population_data <- group_by_special_population(clean_disease_data)
plot_special_population(special_population_data)
```

\newpage

# Distribución espacial de casos

```{r distribution_spatial, echo = FALSE, error = FALSE, warning = FALSE, include = FALSE, message = FALSE}
departments_spacial_data <- group_by_deptos(clean_disease_data)
```

```{r map_distribution_spatial, echo = FALSE, error = FALSE,  warning = FALSE, include = TRUE, message = FALSE, fig.height = 10, fig.width = 10, fig.cap =  "Distribucion espacial de casos"}
departments_spacial_data <- group_by_deptos(clean_disease_data)
plot_dept_map(departments_spacial_data, map_title = "")
```

\newpage

# Conclusiones

a.  Los casos totales reportados de `r disease_name` en Colombia en el año `r year` fueron `r nrow(disease_data)`.
b.  Los meses de `r months_major_cases` tuvieron el mayor reporte. Es posible que haya un impacto en el menor reporte y/o menor transmisión de `r disease_name` como producto de la pandemia COVID-19 y medidas de control que iniciaron en marzo de `r year`.
c.  El reporte de casos de `r disease_name` a lo largo de `r year` predominó en la población de `r age_range_major_cases$edad` años.
d.  El reporte de casos de `r disease_name` predominó a lo largo del año en el sexo masculino.
